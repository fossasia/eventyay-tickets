py_style:
  stage: test
  script:
    - cd server
    - python -m venv env
    - source env/bin/activate
    - pip install -U pip wheel setuptools
    - XDG_CACHE_HOME=/cache pip install black flake8 isort
    - black --check stayseated tests
    - flake8 stayseated tests
    - isort -rc -c stayseated tests
  interruptible: true
  tags:
    - python3
py_test:
  stage: test
  services:
    - redis:latest
    - postgres:11
  script:
    - cd server
    - python -m venv env
    - source env/bin/activate
    - pip install -U pip wheel setuptools
    - XDG_CACHE_HOME=/cache pip install -Ur requirements.txt
    - STAYSEATED_REDIS_HOST=redis STAYSEATED_DB_TYPE=postgresql STAYSEATED_DB_NAME=stayseated STAYSEATED_DB_USER=stayseated STAYSEATED_DB_PASS=stayseated STAYSEATED_DB_HOST=postgres py.test tests/
  interruptible: true
  tags:
    - python3

variables:
  POSTGRES_DB: stayseeated
  POSTGRES_USER: stayseated
  POSTGRES_PASSWORD: stayseated
  POSTGRES_HOST_AUTH_METHOD: trust

